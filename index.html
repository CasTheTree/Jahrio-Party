<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chance Time Multiplayer</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    input, button { padding: 8px; margin: 5px; }
    .hidden { display: none; }
    .player-list img { width: 40px; height: 40px; border-radius: 50%; vertical-align: middle; margin-right: 8px; }
  </style>
</head>
<body>
  <h1>Chance Time Multiplayer</h1>

  <div id="setup">
    <div id="createJoin">
      <button onclick="createRoom()">Create Room</button>
      <input id="roomCodeInput" placeholder="Enter room code" />
      <button onclick="joinRoom()">Join Room</button>
    </div>

    <div id="nameEntry" class="hidden">
      <input id="playerName" placeholder="Enter your name" />
      <input id="imageUrl" placeholder="Image URL (optional)" />
      <button onclick="registerPlayer()">Join Game</button>
    </div>
  </div>

  <div id="lobby" class="hidden">
    <h2>Room Code: <span id="roomCodeDisplay"></span></h2>
    <h3>Players:</h3>
    <div id="players" class="player-list"></div>
  </div>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyAVz8Qq8HaY6e9fGff1Yydh1r82-1bmm44",
  authDomain: "jahrio-party.firebaseapp.com",
  projectId: "jahrio-party",
  storageBucket: "jahrio-party.firebasestorage.app",
  messagingSenderId: "876124455473",
  appId: "1:876124455473:web:e9fa229e482f8ff2c64b10",
  measurementId: "G-M5ZJ7TT8TF"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let roomCode = "";
    let playerId = "player-" + Math.random().toString(36).substring(2, 8);

    function createRoom() {
      roomCode = Math.random().toString(36).substring(2, 6).toUpperCase();
      db.ref("rooms/" + roomCode).set({ created: Date.now() });
      showNameEntry();
    }

    function joinRoom() {
      const code = document.getElementById("roomCodeInput").value.trim().toUpperCase();
      if (!code) return alert("Enter a room code");
      roomCode = code;
      db.ref("rooms/" + roomCode).once("value", snapshot => {
        if (snapshot.exists()) {
          showNameEntry();
        } else {
          alert("Room not found");
        }
      });
    }

    function showNameEntry() {
      document.getElementById("createJoin").classList.add("hidden");
      document.getElementById("nameEntry").classList.remove("hidden");
    }

    function registerPlayer() {
      const name = document.getElementById("playerName").value.trim();
      const image = document.getElementById("imageUrl").value.trim();
      if (!name) return alert("Enter a name");

      db.ref(`rooms/${roomCode}/players/${playerId}`).set({ name, image });
      document.getElementById("setup").classList.add("hidden");
      document.getElementById("lobby").classList.remove("hidden");
      document.getElementById("roomCodeDisplay").textContent = roomCode;

      db.ref(`rooms/${roomCode}/players`).on("value", snapshot => {
        const container = document.getElementById("players");
        container.innerHTML = "";
        snapshot.forEach(child => {
          const data = child.val();
          const div = document.createElement("div");
          div.innerHTML = `${data.image ? `<img src='${data.image}' />` : ""}${data.name}`;
          container.appendChild(div);
        });
      });
    }
  </script>
</body>
</html>
